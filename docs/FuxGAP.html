<!DOCTYPE html>

<html>
<head>
  <title>FuxGAP.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="public/stylesheets/normalize.css" />
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div class="container">
    <div class="page">

      <div class="header">
        
          <h1>FuxGAP.js</h1>
        

        
      </div>

      
        
        <p>FuxGAP counterpoint rules
Copyright Benjamin W. Bohl 2014.
Implements Fux species, first.
<a href="http://www.github.com/bwbohl/FuxGAP">http://www.github.com/bwbohl/FuxGAP</a></p>
<h2 id="description">Description</h2>
<p>This file implements Fux’s first species</p>
<p>reference to testfile</p>

        
      
        
        <p>TODO: arrays to JSON?</p>

        
      
        
        <p>define intervals as arrays with [semitoneSteps, intervalName]</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">var</span> intervals = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span> ([<span class="hljs-number">0</span>, <span class="hljs-string">'P1'</span>],
                           [<span class="hljs-number">1</span>, <span class="hljs-string">'m2'</span>],
                           [<span class="hljs-number">2</span>, <span class="hljs-string">'M2'</span>],
                           [<span class="hljs-number">3</span>, <span class="hljs-string">'m3'</span>],
                           [<span class="hljs-number">4</span>, <span class="hljs-string">'M3'</span>],
                           [<span class="hljs-number">5</span>, <span class="hljs-string">'P4'</span>],
                           [<span class="hljs-number">6</span>, <span class="hljs-string">'TT'</span>],
                           [<span class="hljs-number">7</span>, <span class="hljs-string">'P5'</span>],
                           [<span class="hljs-number">8</span>, <span class="hljs-string">'m6'</span>],
                           [<span class="hljs-number">9</span>, <span class="hljs-string">'M6'</span>],
                           [<span class="hljs-number">10</span>, <span class="hljs-string">'m7'</span>],
                           [<span class="hljs-number">11</span>, <span class="hljs-string">'M7'</span>],
                           [<span class="hljs-number">12</span>, <span class="hljs-string">'P8'</span>]);</pre></div>
        
      
        
        <p>define perfect consonances</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">var</span> cons_perf = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>([<span class="hljs-number">0</span>, <span class="hljs-string">'P1'</span>],
                          [<span class="hljs-number">7</span>, <span class="hljs-string">'P5'</span>],
                          [<span class="hljs-number">12</span>, <span class="hljs-string">'P8'</span>]);</pre></div>
        
      
        
        <p>define imperfect consonances</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">var</span> cons_imp = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span> ([<span class="hljs-number">3</span>, <span class="hljs-string">'m3'</span>],
                          [<span class="hljs-number">4</span>, <span class="hljs-string">'M3'</span>],
                          [<span class="hljs-number">8</span>, <span class="hljs-string">'m6'</span>],
                          [<span class="hljs-number">9</span>, <span class="hljs-string">'M6'</span>]);</pre></div>
        
      
        
        <p>define consonances</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">var</span> consonances = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>().concat(cons_perf, cons_imp);</pre></div>
        
      
        
        <p>define dissonances</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">var</span> dissonances = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>([<span class="hljs-number">1</span>, <span class="hljs-string">'m2'</span>],
                            [<span class="hljs-number">2</span>, <span class="hljs-string">'M2'</span>],
                            [<span class="hljs-number">5</span>, <span class="hljs-string">'P4'</span>],
                            [<span class="hljs-number">6</span>, <span class="hljs-string">'M4'</span>],<span class="hljs-comment">//große4</span>
                            [<span class="hljs-number">6</span>, <span class="hljs-string">'m5'</span>],<span class="hljs-comment">//falsche 5</span>
                            [<span class="hljs-number">10</span>, <span class="hljs-string">'m7'</span>],
                            [<span class="hljs-number">11</span>, <span class="hljs-string">'M7'</span>]);</pre></div>
        
      
        
        <p>array containing pitch names and respective pitch-classes</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">var</span> noteVal = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span> ([<span class="hljs-string">'c'</span>,<span class="hljs-number">1</span>],[<span class="hljs-string">'cis'</span>,<span class="hljs-number">2</span>],[<span class="hljs-string">'des'</span>,<span class="hljs-number">2</span>],[<span class="hljs-string">'d'</span>,<span class="hljs-number">3</span>],[<span class="hljs-string">'dis'</span>,<span class="hljs-number">4</span>],[<span class="hljs-string">'es'</span>,<span class="hljs-number">4</span>],[<span class="hljs-string">'e'</span>,<span class="hljs-number">5</span>],[<span class="hljs-string">'f'</span>,<span class="hljs-number">6</span>],[<span class="hljs-string">'fis'</span>,<span class="hljs-number">7</span>],[<span class="hljs-string">'ges'</span>,<span class="hljs-number">7</span>],[<span class="hljs-string">'g'</span>,<span class="hljs-number">8</span>],[<span class="hljs-string">'gis'</span>,<span class="hljs-number">9</span>],[<span class="hljs-string">'as'</span>,<span class="hljs-number">9</span>],[<span class="hljs-string">'a'</span>,<span class="hljs-number">10</span>],[<span class="hljs-string">'ais'</span>,<span class="hljs-number">11</span>],[<span class="hljs-string">'bb'</span>,<span class="hljs-number">11</span>],[<span class="hljs-string">'b'</span>,<span class="hljs-number">12</span>]);</pre></div>
        
      
        
        <p>melody arrays [pitch-class,octave,duration]</p>

        
      
        
        <p>cantus praefactus of Fux’s first example</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">var</span> cpf1 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span> ([<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">6</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">5</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">8</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">6</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">10</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">8</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">6</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">5</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">1</span>]);</pre></div>
        
      
        
        <p>counterpoint of Fux’s first example</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">var</span> cp11 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span> ([<span class="hljs-number">10</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">10</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">8</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">10</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">12</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">1</span>,<span class="hljs-number">5</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">1</span>,<span class="hljs-number">5</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">12</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">3</span>,<span class="hljs-number">5</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">2</span>,<span class="hljs-number">5</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">3</span>,<span class="hljs-number">5</span>,<span class="hljs-number">1</span>]);</pre></div>
        
      
        
        <p>load MEI XML file of first example for use in vexflow rendering</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">var</span> xmlDoc=loadXMLDoc(<span class="hljs-string">'resources/xml/cpf1.xml'</span>);
  <span class="hljs-keyword">if</span> (xmlDoc) { 
    console.log(<span class="hljs-string">'FuxGAP MEI-XML loaded.'</span>); 
  } <span class="hljs-keyword">else</span> {</pre></div>
        
      
        
        <p>TODO: throw exception</p>

        
          <div class='highlight'><pre>  }</pre></div>
        
      
        
        <p>… and render it onto the canvas</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">var</span> MEI = xmlDoc.getElementsByTagNameNS(<span class="hljs-string">"http://www.music-encoding.org/ns/mei"</span>, <span class="hljs-string">'score'</span>);</pre></div>
        
      
        
        <p>main functio to call evaluation of a supplied cantus praefactus (cpf) and couterpoint (cp)
@param cpf : given javascript array of cantus praefactus melody as seen for example in var cpf1
@param cp : given javascript array of counterpointt melody as seen for example in var cp11 </p>

        
          <div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">eval</span><span class="hljs-params">(cpf,cp)</span>{</span>
  
  spellMelody(cpf, <span class="hljs-string">'cpf'</span>);
  spellMelody(cp, <span class="hljs-string">'cp'</span>);
  spellIntervals(cpf, cp);
  spellSemitoneSteps(cpf, <span class="hljs-string">'cpf_semitones'</span>);
  spellSemitoneSteps(cp, <span class="hljs-string">'cp_semitones'</span>);
  
  <span class="hljs-keyword">if</span> (evaluateSpecies(cpf,cp) == <span class="hljs-string">'first'</span>) {
    FuxGAP_species_first(cpf, cp)
  }
};</pre></div>
        
      
        
        <p>determines the harmonic intervals of two notes in cpf and cp</p>

        
          <div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getInterval</span> <span class="hljs-params">(Ncpf, Ncp)</span> {</span></pre></div>
        
      
        
        <p>TODO: vektor(above, below),
TODO: translate intervals
TODO: refactor to evaluate oct*12 + pitch-class</p>

        
      
        
        <p>calculate the difference between pitch values of cantus praefactus and counterpoint</p>

        
          <div class='highlight'><pre>  <span class="hljs-keyword">var</span> semiV = getIntervalSemitonesVektor(Ncpf, Ncp);
  console.log(<span class="hljs-string">'getInterval vectorized semitones: '</span> + semiV);
  
  <span class="hljs-keyword">var</span> parsons = getParsons(Ncpf,Ncp);
  <span class="hljs-keyword">var</span> semitones = <span class="hljs-built_in">Math</span>.abs(semiV);</pre></div>
        
      
        
        <p>if semiV is negative that is if pitch-class of counterpoint is lower than that of cantus praefactus</p>

        
          <div class='highlight'><pre>  <span class="hljs-keyword">if</span>(semiV &lt; <span class="hljs-number">0</span> ){ <span class="hljs-comment">//TODO better with while?</span></pre></div>
        
      
        
        <p>get absolute semitone value / distance</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">var</span> semi = <span class="hljs-built_in">Math</span>.abs(semiV);
    console.log(<span class="hljs-string">'getInterval abosolute semitones: '</span> + semi);
    <span class="hljs-keyword">return</span> intervals[semi][<span class="hljs-number">1</span>]; <span class="hljs-comment">/* + '/' + semiV*/</span></pre></div>
        
      
        
        <p>if semiV is positive return respective interval</p>

        
          <div class='highlight'><pre>  }<span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> intervals[semiV][<span class="hljs-number">1</span>];<span class="hljs-comment">/* + '/' + semiV*/</span>
  }

};</pre></div>
        
      
        
        <p>determine vectorized (+/-) semitone steps of note 2 in respect to note 1</p>

        
          <div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getIntervalSemitonesVektor</span><span class="hljs-params">(n1,n2)</span>{</span>
    
    <span class="hljs-keyword">try</span>
      {
        val = (n2[<span class="hljs-number">0</span>]+n2[<span class="hljs-number">1</span>]*<span class="hljs-number">12</span>)-(n1[<span class="hljs-number">0</span>]+n1[<span class="hljs-number">1</span>]*<span class="hljs-number">12</span>);
        <span class="hljs-keyword">return</span> val;
      }</pre></div>
        
      
        
        <p>if not two notes are being passed as arguments</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">catch</span>(err)
      {</pre></div>
        
      
        
        <p>if only one note is being passed as argument it is the first note thus return ‘*’ as starting point</p>

        
          <div class='highlight'><pre>        <span class="hljs-keyword">if</span>(n1 === <span class="hljs-literal">undefined</span> || n2 === <span class="hljs-literal">undefined</span>){
            <span class="hljs-keyword">return</span> <span class="hljs-string">'*'</span>;
        }</pre></div>
        
      
        
        <p>if both notes are undefined log an error</p>

        
          <div class='highlight'><pre>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (n1 === <span class="hljs-literal">undefined</span> &amp;&amp; n2 === <span class="hljs-literal">undefined</span>){
            console.log(<span class="hljs-string">'getIntervalSemitonesVektor: missing arguments'</span>);
            <span class="hljs-keyword">return</span>;
        }
      }
};</pre></div>
        
      
        
        <p>return parsons code for given notes</p>

        
          <div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getParsons</span><span class="hljs-params">(n1,n2)</span>{</span>
    <span class="hljs-keyword">var</span> diff = getIntervalSemitonesVektor(n1,n2);
    
    <span class="hljs-keyword">if</span>(diff == <span class="hljs-number">0</span>){
        <span class="hljs-keyword">return</span> <span class="hljs-string">'r'</span>
    }
};</pre></div>
        
      
        
        <p>translates a pitch-class number to a pitch name</p>

        
          <div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">translatePvalToString</span><span class="hljs-params">(val)</span>{</span></pre></div>
        
      
        
        <p>TODO: enharmonics</p>

        
          <div class='highlight'><pre>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x = <span class="hljs-number">0</span>; x &lt; noteVal.length; x++){
    <span class="hljs-keyword">var</span> entry = noteVal[x];
    console.log(entry);
    <span class="hljs-keyword">if</span>(entry[<span class="hljs-number">1</span>] == val){
      <span class="hljs-keyword">return</span> entry[<span class="hljs-number">0</span>];
    }
  }
};</pre></div>
        
      
        
        <p>spells a given melody to pitch names</p>
<p>@param melody : melody array as e.g. seen in var cpf1
@param targetID : gives the id value of a target div the melody shall be spelled to</p>

        
          <div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">spellMelody</span><span class="hljs-params">(melody, targetID)</span> {</span></pre></div>
        
      
        
        <p>TODO: spell melodic intervals</p>

        
          <div class='highlight'><pre>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> n = <span class="hljs-number">0</span>; n &lt; melody.length; n++){
   span = document.createElement(<span class="hljs-string">'span'</span>);
   note = melody[n];
   pval = note[<span class="hljs-number">0</span>];
   
   pname = translatePvalToString(pval);
   
   span.innerHTML = pname + <span class="hljs-string">'&lt;br/&gt;'</span> + note;
   document.getElementById(targetID).appendChild(span); 
   
   console.log(n + <span class="hljs-string">' is '</span> + melody[n]);
   console.log(span);
  }
  <span class="hljs-keyword">return</span> console.log(<span class="hljs-string">'error with melody '</span>+n);
};

<span class="hljs-comment">/* spells the intervals of to given melodies as span elements in a div
 * 
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">spellIntervals</span><span class="hljs-params">(cpf, cf)</span>{</span>
 console.log(<span class="hljs-string">'spellIntervals function called'</span>);
  <span class="hljs-keyword">for</span> (x=<span class="hljs-number">0</span>;x&lt;cpf.length;x++){
    <span class="hljs-keyword">var</span> i = getInterval(cpf[x],cf[x]);</pre></div>
        
      
        
        <p>console.log(cpf[x]);</p>

        
          <div class='highlight'><pre>    span = document.createElement(<span class="hljs-string">'span'</span>);
    
    span.innerHTML = getInterval(cpf[x], cf[x]);
    document.getElementById(<span class="hljs-string">'intervals'</span>).appendChild(span); 

  }
};</pre></div>
        
      
        
        <p>spell the semitone steps from note to note in a given melody to targetID as span elements</p>

        
          <div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">spellSemitoneSteps</span> <span class="hljs-params">(melody, targetID)</span>{</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> n = <span class="hljs-number">0</span>; n &lt; melody.length; n++){
    <span class="hljs-keyword">var</span> span = document.createElement(<span class="hljs-string">'span'</span>);
    <span class="hljs-keyword">var</span> parsons = getIntervalSemitonesVektor(melody[n],melody[n-<span class="hljs-number">1</span>]);
    
    
    <span class="hljs-comment">/*if (n == 0){
      parsons = '*';
    } else if (melody[n][1] &gt; melody[n-1][1]){
      parsons = melody[n][0] - melody[n-1][0] +12;
    } else if (melody[n][1] &lt; melody[n-1][1]){
      parsons = melody[n][0] - melody[n-1][0] -12;
    } else {
      parsons = melody[n][0] - melody[n-1][0];
    }*/</span>
    <span class="hljs-comment">/*console.log(parsons);*/</span>
    
    span.innerHTML = parsons;
    document.getElementById(targetID).appendChild(span);
  }
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">evaluateMotus</span><span class="hljs-params">()</span>{</span>
  <span class="hljs-comment">/* get Harmony
 * dur2beats
 * MeiLib.dotsMult
 * sumUpUntil
 */</span>
};




<span class="hljs-comment">/*
 * Evaluates the species of the supplied counterpoint composition
 * 
 * @param: cpf the given Cantus Praefactus melody
 * @param: cp the corresponding Counterpoint melody
 */</span>
evaluateSpecies = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(cpf, cp)</span>{</span></pre></div>
        
      
        
        <p>log that function has been called</p>

        
          <div class='highlight'><pre>  console.log(<span class="hljs-string">'evaluateSpecies called'</span>);</pre></div>
        
      
        
        <p>species will hold the result of the evalulation</p>

        
          <div class='highlight'><pre>  <span class="hljs-keyword">var</span> species = <span class="hljs-keyword">new</span> <span class="hljs-built_in">String</span>();</pre></div>
        
      
        
        <p>durs_cpf is an array that will hold all the duration values of the Cantus Praefactus</p>

        
          <div class='highlight'><pre>  <span class="hljs-keyword">var</span> durs_cpf = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>();</pre></div>
        
      
        
        <p>durs_cp is an array that will hold all the duration values of the Counterpoint</p>

        
          <div class='highlight'><pre>  <span class="hljs-keyword">var</span> durs_cp = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>();</pre></div>
        
      
        
        <p>assign default value to var species</p>

        
          <div class='highlight'><pre>  species = <span class="hljs-string">'undetermined'</span>;</pre></div>
        
      
        
        <p>push cpf durations to durs_cpf</p>

        
          <div class='highlight'><pre>  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; cpf.length; i++){
    <span class="hljs-comment">/*console.log('pos: ' + i);
    console.log('value: ' + cp[i][2]);*/</span>
    durs_cpf.push(cpf[i][<span class="hljs-number">2</span>]);
  }</pre></div>
        
      
        
        <p>push cp durations to durs_cpf</p>

        
          <div class='highlight'><pre>  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; cp.length; i++){
    <span class="hljs-comment">/*console.log('pos: ' + i);
    console.log('value: ' + cp[i][2]);*/</span>
    durs_cp.push(cp[i][<span class="hljs-number">2</span>]);
  }</pre></div>
        
      
        
        <p>check for first species</p>

        
          <div class='highlight'><pre>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; durs_cp.length; i++){
    <span class="hljs-keyword">if</span> (durs_cp[i] == durs_cpf[i]){
      species = <span class="hljs-string">'first'</span>;
    }
  }</pre></div>
        
      
        
        <p>log var species</p>

        
          <div class='highlight'><pre>  console.log(<span class="hljs-string">'species: '</span>+ species);
  
  <span class="hljs-comment">/*console.log('durs_cp: ');
  console.log(durs_cp);*/</span>
  
  <span class="hljs-keyword">return</span> species;
  
};</pre></div>
        
      
        
        <p>determines whether the cantus praefactus is below of above the counterpoint
to do so cpf notes above and below are being counted
if numbers are identical returns ‘equilibrium’
else returns ‘above’ if more notes are above and resp. ‘below’ if more notes are below</p>

        
          <div class='highlight'><pre>checkCpfPos = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(cpf,cp)</span>{</span>
   
   <span class="hljs-keyword">var</span> cpf_pos = <span class="hljs-keyword">new</span> <span class="hljs-built_in">String</span>();
   <span class="hljs-keyword">var</span> cpf_above = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>();
   <span class="hljs-keyword">var</span> cpf_below = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>();</pre></div>
        
      
        
        <p>push notes to respective array in dependency of their individual position</p>

        
          <div class='highlight'><pre>   <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; cpf.length; i++){
      <span class="hljs-keyword">if</span> (cpf[i][<span class="hljs-number">1</span>] &gt; cp[i][<span class="hljs-number">1</span>]){
        cpf_above.push(i);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (cpf[i][<span class="hljs-number">1</span>] &lt; cp[i][<span class="hljs-number">1</span>]){
        cpf_below.push(i);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (cpf[i][<span class="hljs-number">0</span>] &gt; cp[i][<span class="hljs-number">0</span>]){
        cpf_above.push(i)
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (cpf[i][<span class="hljs-number">0</span>] &lt; cp[i][<span class="hljs-number">0</span>]){
        cpf_below.push(i)
    }
   };</pre></div>
        
      
        
        <p>evaluate array lengths to determine estimated position of cantus praefactus</p>

        
          <div class='highlight'><pre>   <span class="hljs-keyword">if</span>(cpf_above.length &gt; cpf_below.length){
      cpf_pos = <span class="hljs-string">'above'</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (cpf_above.length &lt; cpf_below.length){
      cpf_pos = <span class="hljs-string">'below'</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (cpf_above.length == cpf_below.length){
      cpf_pos = <span class="hljs-string">'equilibrium'</span>;
   }</pre></div>
        
      
        
        <p>log numbers and arrays for debugging purposes</p>

        
          <div class='highlight'><pre>   console.log(<span class="hljs-string">'above: '</span> + cpf_above.length);
   console.log(cpf_above);
   console.log(<span class="hljs-string">'below: '</span> + cpf_below.length);
   console.log(cpf_below);</pre></div>
        
      
        
        <p>log result</p>

        
          <div class='highlight'><pre>   console.log(<span class="hljs-string">'cpf_pos: '</span>+ cpf_pos);</pre></div>
        
      
        
        <p>return estimated position of counterpoint</p>

        
          <div class='highlight'><pre>   <span class="hljs-keyword">return</span> cpf_pos;
};

<span class="hljs-comment">/*FuxGAP.rules.motus.rectus = function(Ncpf,Ncp){
  
};*/</span>

<span class="hljs-comment">/*
 * einerley zeitmaß --&gt; evaluate species
 * halbkurze note
 * zwei stimmen
 * schlechter gesang
 * nur consonanzen
 * Anfang perfekt
 * GEN: cf oben =&gt; erste note cp muss identisch sein
 * 
 * widrige oder seitn öfters fehlt man nicht so leicht
 * behutsam bei gerader bewegung
 * 
 * mehr unvollkommene als vollkommene
 * Ende perfekt
 * cf unten =&gt; paenultima g6
 * cf oben =&gt; paenultima k3
 * 
 * Bsp 1
 * 
 * Bsp 2 (cf oben)
 * 
 * 
 * HAR: gerade bewegung verboten weil zwei Quinten fogeln
 * 
 *
 * Bsp 3
 * 
 * weitere übung in natürlichen Leitern
 * 
 * MEL/GEN: Sprung Tritonus verboten bzw Tritonus in Cp verboten
 *  
 * Bsp 4
 * 
 * Bsp 5
 * (Stimmkreuzung gut)
 * 
 * Bsp 6
 * 
 * MEL: Sprung g6 verboten
 * 
 * Ottava Battuta verboten (decime -&gt; in gegenbewegung)
 * stellt benutzung frey, wenn aber untere stimme stufenweise nach oben und oben springt dann auf gar keinen Fall
 * 
 * von einklang zu andere konsonanz sprung verboten, außer der schlechte gesang gibt dies vor
 * 
 * Einklang verboten, außer am Anfang und am Ende
 * 
 * mi gerne hinauf fa gerne hinunter (angleichung des kreuzes an die k3 der paenultima)
 */</span>
 
FuxGAP_species_first = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(cpf, cp)</span>{</span></pre></div>
        
      
        
        <p>determine position of cantus preafactus in respect to counterpoint</p>

        
          <div class='highlight'><pre>  <span class="hljs-keyword">var</span> cpf_pos = checkCpfPos(cpf,cp);</pre></div>
        
      
        
        <p>for testing assign manually</p>

        
          <div class='highlight'><pre>  cpf_pos = <span class="hljs-string">'above'</span>;
  console.log(<span class="hljs-string">'manual override cpf_pos: '</span> + cpf_pos);</pre></div>
        
      
        
        <p>log cpf_pos</p>

        
          <div class='highlight'><pre>  console.log(<span class="hljs-string">'cpf_pos: '</span>+ cpf_pos);</pre></div>
        
      
        
        <p>determine first interval</p>

        
          <div class='highlight'><pre>  <span class="hljs-keyword">var</span> int_first = getInterval(cpf[<span class="hljs-number">0</span>], cp[<span class="hljs-number">0</span>]);
   
  console.log(int_first);</pre></div>
        
      
        
        <p>check rules with respect to counterpoint/cantus prafactus positions</p>

        
          <div class='highlight'><pre>  <span class="hljs-keyword">switch</span>(cpf_pos){</pre></div>
        
      
        
        <p>if cpf above then first note has to be identical resp P8 (or P1?)
TODO P1</p>

        
          <div class='highlight'><pre>	  <span class="hljs-keyword">case</span> <span class="hljs-string">'above'</span>:
	    console.log(<span class="hljs-string">'species first: '</span> + <span class="hljs-string">'cpf: '</span> + cpf_pos);
	    
	     <span class="hljs-keyword">var</span> allowedValues = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>();
	   
	    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;cons_perf.length;i++){
	      <span class="hljs-keyword">if</span>(cons_perf[i][<span class="hljs-number">1</span>] != <span class="hljs-string">'P5'</span>){
	        allowedValues.push(cons_perf[i][<span class="hljs-number">1</span>]);
	      }
	    }
	   
	    <span class="hljs-keyword">if</span>($.inArray(int_first, allowedValues) !== -<span class="hljs-number">1</span>){
	      console.log(<span class="hljs-string">'first interval: correct'</span>);
	    }<span class="hljs-keyword">else</span>{
	      console.log(<span class="hljs-string">'species1_error: first interval: incorrect'</span>);           
	    }
	    <span class="hljs-keyword">break</span>;</pre></div>
        
      
        
        <p>if cpf below then first interval has to be perfect consonance</p>

        
          <div class='highlight'><pre>	  <span class="hljs-keyword">case</span> <span class="hljs-string">'below'</span>:
	   
	    <span class="hljs-keyword">var</span> allowedValues = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>();
	   
	    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;cons_perf.length;i++){
	      allowedValues.push(cons_perf[i][<span class="hljs-number">1</span>]);
	    }
	   
	    <span class="hljs-keyword">var</span> int_first = getInterval(cpf[<span class="hljs-number">0</span>], cp[<span class="hljs-number">0</span>]);
	    <span class="hljs-keyword">var</span> int_pos = $.inArray(int_first,allowedValues)
	   
	    console.log(<span class="hljs-string">'species first: '</span> + <span class="hljs-string">'cpf_pos case: '</span> + cpf_pos);
	    console.log(<span class="hljs-string">'species fist: interval first: '</span> + getInterval(cpf[<span class="hljs-number">0</span>], cp[<span class="hljs-number">0</span>]));
	   
	    console.log(<span class="hljs-string">'index of int '</span> + int_pos);
	   
	    <span class="hljs-keyword">if</span> ($.inArray(int_first, allowedValues) !== -<span class="hljs-number">1</span>){
	      console.log(<span class="hljs-string">'species first: interval first: correct'</span>);
	    } <span class="hljs-keyword">else</span> {
	        console.log(<span class="hljs-string">'species1_error: first interval: incorrect'</span>);
	    }
	   
	   <span class="hljs-keyword">break</span>;
   }</pre></div>
        
      
        
        <p>check for consonances</p>

        
          <div class='highlight'><pre>  
    
};</pre></div>
        
      
      <div class="fleur">h</div>
    </div>
  </div>
</body>
</html>
